<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listen to Audio</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
      <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .audio-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        .error-message {
            text-align: center;
            color: #ff0000;
        }
        .thumbnail {
            width: 100%;
            max-width: 640px;
            margin-bottom: 10px;
        }
           </style>
</head>
<body>

    <div class="container">
        <h1>Listen to Audio</h1>
        <div class="search-container mb-4">
            <input type="text" id="searchQuery" class="form-control me-2" placeholder="Search for audio...">
            <button class="btn btn-primary" onclick="searchAudio()">Search</button>
        </div>
        
        <div class="audio-container" id="audioContainer">
            <!-- Plyr audio player will be embedded here -->
        </div>

        <a class="btn btn-secondary d-block mx-auto" href="search.html">Back to Search</a>
    </div>

    <script src="https://cdn.plyr.io/3.6.8/plyr.polyfilled.js"></script>
    <script>
const urlParams = new URLSearchParams(window.location.search);

function searchAudio() {
    const query = document.getElementById('searchQuery').value;
    window.location.href = `search.html?q=${encodeURIComponent(query)}`;
}

function loadAudio() {
    const audioId = urlParams.get('id');
    const audioContainer = document.getElementById('audioContainer');

    if (audioId) {
        const audioUrl = `/ytprx/audio/${audioId}.mp3`; // Assuming audio files are in mp3 format
        const infoUrl = `/ytprx/info/${audioId}.json`; // Fetch audio info
        const posterUrl = `https://cors-proxy.cooks.fyi/https://i3.ytimg.com/vi/${audioId}/maxresdefault.jpg`;

        // Fetch audio information
        fetch(infoUrl)
            .then(response => response.json())
            .then(data => {
                const snippet = data.data.snippet;
                const title = snippet.title;
                const description = snippet.description;

                // Update the audio container with title, description, thumbnail, and audio player
                audioContainer.innerHTML = `
                    <img src="${posterUrl}" alt="${title}" class="thumbnail">
                    <h2 id="audioTitle">${title}</h2>
                    <p>${description}</p>
                    <audio controls crossorigin playsinline id="player" autoplay>
                        <source src="${audioUrl}" type="audio/mp3">
                        Your browser does not support the audio tag.
                    </audio>
                `;

                // Initialize Plyr
                const player = new Plyr('#player', {
                    settings: ['play', 'mute', 'volume', 'fullscreen', 'download'],
                    download: true // Enable download button
                });

                // Set media session metadata
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: title,
                        artist: 'YT SEARCH BY WTHISTHIS', // Replace with actual artist name if available
                        album: 'YT SEARCH BY WTHISTHIS', // Replace with actual album name if available
                        artwork: [
                            { src: posterUrl, sizes: '512x512', type: 'image/png' },
                            { src: posterUrl, sizes: '256x256', type: 'image/png' },
                            { src: posterUrl, sizes: '128x128', type: 'image/png' }
                        ]
                    });
                }

                // Retry loading audio if it fails
                player.on('error', () => {
                    console.error('Audio failed to load, retrying...');
                    setTimeout(() => {
                        player.source = {
                            type: 'audio',
                            sources: [{
                                src: audioUrl,
                                type: 'audio/mp3',
                            }],
                        };
                    }, 1000); // Retry after 1 second
                });
            })
            .catch(error => {
                console.error('Error fetching audio info:', error);
                audioContainer.innerHTML = '<p class="error-message">Audio not found.</p>';
            });
    } else {
        audioContainer.innerHTML = '<p class="error-message">Audio not found.</p>';
    }
}

// Load the audio when the page is loaded
window.onload = loadAudio;

    </script>

</body>
</html>
